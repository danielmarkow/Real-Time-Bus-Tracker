<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Real Time Bus Tracker</title>
        <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
		<link href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" rel="stylesheet" />
		<style>
			body { margin: 0; padding: 0; }
			#map { position: absolute; top: 0; bottom: 0; width: 100%; }
		</style>
    </head>
    <body>
        <div id="map"></div>
    </body>
    <script src="accessToken.js"></script>
    <script>
        mapboxgl.accessToken = accessToken;
        
        let markers = [];

        function init() {
            // create map
            let map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [-71.104081, 42.365554],
                zoom: 14
            });

            getBusLocations().then(
                busses => {
                    busses.forEach((bus) => {
                        let lat = bus["attributes"]["latitude"];
						let long = bus["attributes"]["longitude"];
                        const marker = new mapboxgl.Marker()
                            .setLngLat([long, lat])
                            .addTo(map);
                        
                        markers.push({id: bus["id"], bus_marker: marker})
                    })
                }
            )
            // TODO implement refresh
            // setTimeout(refresh, 15000);
        }

        async function getBusLocations(){
			const url = 'https://api-v3.mbta.com/vehicles?filter[route]=1&include=trip';
			const response = await fetch(url);
			const json     = await response.json();
			return json.data;
		}

        init();

        console.log(markers);
    </script>
</html>